<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ë¬¸ ê´€ë¦¬</title>
<link rel="stylesheet" href="/css/manager/managerSale.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script defer src="/js/manager/managerSale.js"></script>
</head>
<body>
	<!-- í—¤ë” -->
	<div th:replace="~{header :: header}"></div>

	<main>
		<h1>ğŸ›’ ì£¼ë¬¸ ê´€ë¦¬</h1>

		<div class="dashboardHeader">
			<div class="infoBox">
				<h3>â° ì…ê¸ˆ ì „</h3>
				<p
					th:text="${#strings.isEmpty(orderCountByProcess['before']) ? 0 : orderCountByProcess['before']}+'ê±´'">0ê±´</p>
			</div>
			<div class="infoBox">
				<h3>ğŸ“¦ ë°°ì†¡ì¤€ë¹„ ì¤‘</h3>
				<p
					th:text="${#strings.isEmpty(orderCountByProcess['ready']) ? 0 : orderCountByProcess['ready']}+'ê±´'">0ê±´</p>
			</div>
			<div class="infoBox">
				<h3>ğŸš› ë°°ì†¡ ì¤‘</h3>
				<p
					th:text="${#strings.isEmpty(orderCountByProcess['delivery']) ? 0 : orderCountByProcess['delivery']}+'ê±´'">0ê±´</p>
			</div>
			<div class="infoBox">
				<h3>âœ… ë°°ì†¡ì™„ë£Œ</h3>
				<p
					th:text="${#strings.isEmpty(orderCountByProcess['done']) ? 0 : orderCountByProcess['done']}+'ê±´'">0ê±´</p>
			</div>
		</div>

		<!-- ë§¤ì¶œ ì°¨íŠ¸ (ì›”ë³„ ë° ì¹´í…Œê³ ë¦¬ë³„) -->
		<div class="chart-section">
			<!-- ì›”ë³„ ì°¨íŠ¸ -->
			<div class="chart-container">
				<canvas id="salesChartMonthly"></canvas>
			</div>

			<!-- ì¹´í…Œê³ ë¦¬ë³„ ì°¨íŠ¸ -->
			<div class="chart-container">
				<canvas id="salesChartCategory"></canvas>
			</div>
		</div>

		<!-- ì£¼ë¬¸ í…Œì´ë¸” -->
		<table class="notice-table">
			<thead>
				<tr>
					<th>ë²ˆí˜¸</th>
					<th>ìƒí’ˆì´ë¯¸ì§€</th>
					<th>ì£¼ë¬¸ì¼ì‹œ</th>
					<th>ì¹´í…Œê³ ë¦¬</th>
					<th>ì£¼ë¬¸ì •ë³´</th>
					<th>ìˆ˜ëŸ‰</th>
					<th>ìƒí’ˆê¸ˆì•¡</th>
					<th>ì£¼ë¬¸ì•„ì´ë””</th>
					<th>ì£¼ë¬¸ìƒíƒœ</th>
					<th> </th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="sale : ${saleData}">
					<td th:text="${sale.id}"></td>
					<td>
						<img th:src="@{${sale.imageUrl}}" alt="ìƒí’ˆ ì´ë¯¸ì§€" style="width: 50px; height: 50px;"/>
					</td>
					<td th:text="${sale.orderDate}"></td>
					<td th:text="${sale.category}"></td>
					<td th:text="${sale.itemname}"></td>
					<td th:text="${sale.productMany}"></td>
					<td th:text="${sale.totalPrice}"></td>
					<td th:text="'ğŸ™â€â™‚ï¸'+${sale.username}"></td>
					<td>
						<!-- process ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” select box --> <select
						class="process-select" data-sale-id="${sale.id}">
							<option value="before" th:selected="${sale.process == 'before'}">ì…ê¸ˆ
								ì „</option>
							<option value="ready" th:selected="${sale.process == 'ready'}">ë°°ì†¡ì¤€ë¹„
								ì¤‘</option>
							<option value="delivery"
								th:selected="${sale.process == 'delivery'}">ë°°ì†¡ ì¤‘</option>
							<option value="done" th:selected="${sale.process == 'done'}">ë°°ì†¡ì™„ë£Œ</option>
					</select>
					</td>
					<td>
						<!-- ìˆ˜ì • ë²„íŠ¼ -->
						<button class="update-process-btn"
							th:attr="data-sale-id=${sale.id}">ìˆ˜ì •</button> 
						<!-- ì‚­ì œ ë²„íŠ¼ -->
						<button class="delete-process-btn"
							th:attr="data-sale-id=${sale.id}">âŒ</button>
					</td>
				</tr>
			</tbody>
		</table>

		<div class="pagination">
			<!-- ì´ì „ ë²„íŠ¼ -->
			<button th:if="${currentPage > 0}"
				th:onclick="|window.location.href='/manager/ManagerSale?page=${currentPage - 1}&size=${pageSize}'|">&lt;</button>

			<!-- í˜ì´ì§€ ë²ˆí˜¸ -->
			<span th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
				th:classappend="${i == currentPage} ? 'active' : ''"
				th:onclick="|window.location.href='/manager/ManagerSale?page=${i}&size=${pageSize}'|"
				th:text="${i + 1}"> </span>

			<!-- ë‹¤ìŒ ë²„íŠ¼ -->
			<button th:if="${currentPage < totalPages - 1}"
				th:onclick="|window.location.href='/manager/ManagerSale?page=${currentPage + 1}&size=${pageSize}'|">&gt;</button>
		</div>

		<!-- ê²€ìƒ‰ ì„¹ì…˜ -->
		<div class="search-section">
			<form method="get" action="/manager/ManagerSale">
				<label for="search-option">ê²€ìƒ‰ ì˜µì…˜:</label> <select id="search-option"
					name="searchOption">
					<option value="process" th:selected="${searchOption == 'process'}">ì£¼ë¬¸ìƒíƒœ</option>
					<option value="orderInfo"
						th:selected="${searchOption == 'orderInfo'}">ì£¼ë¬¸ì •ë³´</option>
					<!-- ì£¼ë¬¸ì •ë³´ ê²€ìƒ‰ ì˜µì…˜ ì¶”ê°€ -->
				</select> <input type="text" id="search-input" name="keyword"
					placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
					th:value="${keyword != null ? keyword : ''}">

				<button type="submit">ê²€ìƒ‰</button>
			</form>
		</div>

	</main>

	<!-- í‘¸í„° -->
	<div th:replace="~{footer :: footer}"></div>

	<!-- ë§¤ì¶œ ë°ì´í„°ë¥¼ JavaScriptë¡œ ì „ë‹¬ -->
	<script th:inline="javascript">
        const salesByMonth = /*[[${salesByMonth}]]*/ {};
        const salesByCategory = /*[[${salesByCategory}]]*/ {};

        const months = [
            '2025-01', '2025-02', '2025-03', '2025-04', 
            '2025-05', '2025-06', '2025-07', '2025-08', 
            '2025-09', '2025-10', '2025-11', '2025-12'
        ];

        const chartDataMonthly = months.map(month => salesByMonth[month] || 0);

        const categories = ['outer', 'top', 'bottom', 'ops', 'acc'];
        const chartDataCategory = categories.map(category => salesByCategory[category] || 0);

        const ctxMonthly = document.getElementById('salesChartMonthly').getContext('2d');
        const salesChartMonthly = new Chart(ctxMonthly, {
            type: 'line',
            data: {
                labels: months.map(m => m.replace('2025-', '') + 'ì›”'),
                datasets: [{
                    label: 'ë§¤ì¶œ ê¸ˆì•¡',
                    data: chartDataMonthly,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'ì›”ë³„ ë§¤ì¶œ ê¸ˆì•¡ (2025)' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        const ctxCategory = document.getElementById('salesChartCategory').getContext('2d');
        const salesChartCategory = new Chart(ctxCategory, {
            type: 'bar',
            data: {
                labels: categories.map(c => c.toUpperCase()),
                datasets: [{
                    label: 'ë§¤ì¶œ ê¸ˆì•¡',
                    data: chartDataCategory,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œ ê¸ˆì•¡ (2025)' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    </script>
</body>
</html>
